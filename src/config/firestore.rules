/**
 * FIRESTORE SECURITY RULES FOR LOGICORE
 *
 * ⚠️ IMPORTANT: These rules must be deployed via Firebase Console:
 * 1. Go to https://console.firebase.google.com
 * 2. Select your project (logicoree77)
 * 3. Firestore Database → Rules tab
 * 4. Replace all content with the rules below
 * 5. Click "Publish"
 *
 * HOW THESE RULES WORK:
 * - Any authenticated user can read their own profile from /users/{uid}
 * - The app stores the role in the user document; we read it at the app level,
 *   NOT inside security rules (avoids recursive/slow rule lookups).
 * - All authenticated users can read all collections.
 * - Write access is open to all authenticated users (role enforcement is done
 *   in the app UI layer). Tighten after your MVP if needed.
 */

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ─── USERS COLLECTION ───
    // Any authenticated user can read/write their own profile
    // Allow creates so the setup script and new user registration work
    match /users/{userId} {
      allow read:   if request.auth != null;
      allow write:  if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }

    // ─── VEHICLES COLLECTION ───
    // Any authenticated user can read; any authenticated user can write
    match /vehicles/{vehicleId} {
      allow read, write: if request.auth != null;
    }

    // ─── DRIVERS COLLECTION ───
    match /drivers/{driverId} {
      allow read, write: if request.auth != null;
    }

    // ─── TRIPS COLLECTION ───
    match /trips/{tripId} {
      allow read, write: if request.auth != null;
    }

    // ─── EXPENSES COLLECTION ───
    match /expenses/{expenseId} {
      allow read, write: if request.auth != null;
    }

    // ─── MAINTENANCELOGS COLLECTION ───
    match /maintenanceLogs/{logId} {
      allow read, write: if request.auth != null;
    }

    // ─── DEFAULT DENY ───
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
